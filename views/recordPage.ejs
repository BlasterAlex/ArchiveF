<!DOCTYPE html>
<html>

<head>
  <title>
    <%= record.name %>
  </title>
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/recordPage/style.css" type="text/css">
  <link rel="stylesheet" href="/css/recordPage/photoUpField.css" type="text/css">
  <%- include('blocks/head.ejs') %>
    <script src="/js/blocks/gallery.js" type="text/javascript"></script>
    <script src="/js/photoUpload/onRecordPage.js" type="text/javascript"></script>
</head>

<body>
  <header>
    <%- include('blocks/header.ejs') %>
  </header>

  <article>
    <% if (errors.length !=0) { %>
      <div class="alert alert-danger">
        <% for (var i=0; i < errors.length; i++) { %>
          <div>
            <%= errors[i] %>
          </div>
          <% } %>
      </div>
      <% } %>
        <% if (messages.length !=0) { %>
          <div class="alert alert-success">
            <% for (var i=0; i < messages.length; i++) { %>
              <div>
                <%= messages[i] %>
              </div>
              <% } %>
          </div>
          <% } %>
            <% if (record.length===0) { %>
              <div class="noRec">
                <h3> В базе пока нет ни одной записи... </h3>
                <div><a href="/add">Создать новую</a></div>
              </div>
              <% } else { %>
                <div class="record-page" id="<%= record.id %>">
                  <div class="record-imgs">
                    <div id="largePicContainer">
                      <img src="/img/accept.png" id="recordAccept" style="display: none" />
                      <a href="/<%= record.img %>" id="largePicLink" style="display: none">
                        <img src="/<%= record.img %>" name="<%= record.img %>" id="largePic" onload="imgLoad(this)"
                          onerror="imgError(this)" />
                      </a>
                    </div>
                    <div id="thumbs" class="record-imgs-bottom">
                      <% record.addImages.forEach(function(img) { %>
                        <div class="smallPicContainer" style="display: none;">
                          <img src="/img/red-cross.png" class="recordRedCross" />
                          <img src="/<%= img %>" name="<%= img %>" class="smallPic" onload="imgLoad(this)"
                            onerror="imgError(this)" />
                        </div>
                        <% }); %>
                          <% if (record.addImages.length < 3) { %>
                            <div class="add_picture_link">
                              <div>
                                <img id="upload-image" src="/img/plus.png">
                                <input type="file" id="file-input" name="Images" required multiple />
                                <label id="get-file-label">Выберите файл</label>
                                <span>или перетащите его сюда</span>
                              </div>
                            </div>
                            <% } %>
                    </div>
                  </div>
                  <div class="record-content">
                    <form ref='uploadForm' id='update-form' action='/record/update' method='post'
                      encType="multipart/form-data">
                      <h1>
                        <%= record.name %>
                      </h1>
                      <div class='record-dates'>
                        <p><b>Создано:</b>
                          <%= record.created %>
                        </p>
                        <p <% if (!record.changed) { %> style="display: none" <% } %>><b>Изменено:</b> <span
                              id="record-dateOfChange">
                              <%= record.changed %>
                            </span></p>
                      </div>
                      <div class="form-group required" id="update-name-field" style="display: none">
                        <input type="name" name="name" class="form-control" id="update-name" placeholder="Enter name"
                          value="<%= record.name %>" required>
                      </div>
                      <% if (numOfLinks) { %>
                        <div class="record-links">
                          <h3>Ссылки</h3>
                          <ul>
                            <span id="numOfLinks" hidden="true">
                              <%= numOfLinks %>
                            </span>
                            <% if (record.links.length) { %>
                              <!-- Есть ссылки -->
                              <% for (var i=0, counter=0; i < record.links.length && i < numOfLinks; i++) { %>
                                <li>
                                  <p class="record-link">
                                    <a href="<%= record.links[i].url %>" target="_blank">
                                      <!-- Добавить имя на ссылку, если есть -->
                                      <% if (record.links[i].name.length !=0) { %>
                                        <%= record.links[i].name %>
                                          <% } else { %>
                                            link <%= ++counter %>
                                              <% } %>
                                    </a>
                                  </p>
                                </li>
                                <div class="input-group input-group-rounded link-block" style="display: none">
                                  <input type="url" class="form-control url-input" name="url"
                                    placeholder="Enter your link" value="<%= record.links[i].url %>">
                                  <input type="text" class="form-control url-name-input" name="linkName"
                                    placeholder="Name of link (or empty)" value="<%= record.links[i].name %>">
                                  <div class="input-group-button move-link">
                                    <i class="fa fa-chevron-up"></i>
                                    <i class="fa fa-chevron-down"></i>
                                  </div>
                                  <div class="input-group-button remove-link">
                                    <div class="input-group-text"><img src="/img/red-cross.png" /></div>
                                  </div>
                                </div>
                                <% }; %>
                                  <% } else { %>
                                    <!-- Нет ни одной ссылки -->
                                    <p id="dot-dot-dot">...</p>
                                    <% } %>
                          </ul>
                          <div class="add-button-container" id="form-add-links-button" style="display: none">
                            <p style="margin: 2px 0 0 0; font-size: 16px;">Добавить ссылку</p>
                            <img src="/img/plus.png" class="form-add-links-button" />
                          </div>
                        </div>
                        <% } %>
                          <input type="hidden" name="id" class="form-control" id="id" value="<%= record.id %>" required>
                    </form>
                    <div style="width: 100%; text-align: center">
                      <button type="submit" class="btn btn-primary" id="save-update-button"
                        style="display: none">Сохранить</button>
                      <button class="btn btn-warning" id="cancel-changes" style="display: none">Отменить</button>
                      <button class="btn btn-success" id="show-update-form">Редактировать</button>
                    </div>
                  </div>
                </div>
                <% } %>
  </article>

  <script src="/js/utils/clearFlash.js" type="text/javascript"></script>
  <script src="/js/utils/bootstrap-validate.js" type="text/javascript"></script>
  <script src="/js/utils/button-actions.js" type="text/javascript"></script>
  <script src="/js/links/linkActions.js" type="text/javascript"></script>
</body>

</html>